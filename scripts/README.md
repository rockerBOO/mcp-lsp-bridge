# MCP External Testing Scripts

This directory contains scripts for testing the MCP-LSP Bridge server externally, simulating how Claude Code would interact with the MCP server.

## Available Scripts

### 1. MCP Tools Test (Primary Development Tool)
- **File**: `test_mcp_tools.py`
- **Description**: Primary MCP tools functionality test referenced in CLAUDE.md
- **Usage**: `uv run python scripts/test_mcp_tools.py` or `make test-mcp-tools`

**Features:**
- Tests each MCP tool individually
- Validates tool responses
- Comprehensive functionality verification
- Primary tool for development testing

### 2. Performance Test
- **File**: `performance_test.py`
- **Description**: Performance testing for analysis functionality
- **Usage**: `uv run python scripts/performance_test.py` or `make test-mcp-performance`

**Features:**
- Tests various analysis types with different complexity levels
- Measures execution duration and response sizes
- Validates all analysis operations (file, workspace, symbols, patterns)
- Identifies slow operations and performance bottlenecks
- 100% success rate validation

### 3. Memory Test
- **File**: `memory_test.py`
- **Description**: Memory usage monitoring for analysis operations
- **Usage**: `uv run python scripts/memory_test.py` or `make test-mcp-memory`

**Features:**
- Monitors memory consumption during analysis operations
- Tracks baseline, peak, and final memory usage
- Detects memory leaks and high usage patterns
- No external dependencies (uses built-in `resource` module)
- System memory info display on Linux

## Test Coverage

The MCP testing scripts cover:

1. **MCP Tools Test**: Core MCP tools functionality and tool responses
2. **Performance Test**: Analysis operations performance and duration tracking
3. **Memory Test**: Memory usage monitoring and leak detection

## Requirements

### All Scripts
- Python 3.8+
- uv (Python package manager)
- No external dependencies (uses built-in modules only)

## Usage Examples

```bash
# Run individual tools test (primary development tool)
make test-mcp-tools

# Run performance tests
make test-mcp-performance

# Run memory tests
make test-mcp-memory

# Run all MCP tests
make test-mcp-all

# Run tests directly
uv run python scripts/test_mcp_tools.py
uv run python scripts/performance_test.py
uv run python scripts/memory_test.py
```

## Output Files

- **Report File**: `mcp_test_report.json` - JSON test report with results (generated by comprehensive tests)

## Test Results

Each test produces:
- **Success/Failure status**
- **Execution duration**
- **Error messages** (if any)
- **Server responses** (in JSON report)

## Integration with CI/CD

The tests are designed to be CI/CD friendly:
- Return appropriate exit codes (0 = success, 1 = failure)
- Generate machine-readable JSON reports
- Provide colored output for human readability
- Include timeout handling to prevent hanging

## Troubleshooting

### Common Issues

1. **Build Failures**
   - Ensure Go is installed and in PATH
   - Run `go mod tidy` in project root

2. **Server Start Failures**
   - Check if required LSP servers are installed
   - Review log file for detailed error messages

3. **Connection Issues**
   - Ensure no other process is using the same port
   - Check firewall settings

4. **Timeout Issues**
   - Increase timeout values in scripts
   - Check system performance

### Debug Mode

For debugging, check the log file:
```bash
tail -f scripts/mcp_test.log
```

## Contributing

When adding new tests:
1. Follow the existing test pattern
2. Add appropriate error handling
3. Update this README
4. Ensure cross-platform compatibility